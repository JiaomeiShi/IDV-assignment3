<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>IDV Assignment 3 — Charts 7–11</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, "PingFang SC", "Microsoft YaHei", sans-serif;
      margin: 0;
      padding: 32px;
      background: #eef4f4;
    }
    h1 {
      margin: 0 0 8px;
    }
    .subtitle {
      margin: 0 0 24px;
      color: #4b5563;
    }
    .chart-card {
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.06);
      padding: 20px;
      margin-bottom: 28px;
    }
    .chart-title {
      margin: 0 0 4px;
    }
    .chart-subtitle {
      margin: 0 0 16px;
      color: #6b7280;
      font-size: 0.9rem;
    }
    .note {
      margin-top: 12px;
      padding-top: 8px;
      border-top: 1px dashed #e5e7eb;
      font-size: 0.9rem;
      color: #374151;
      line-height: 1.5;
    }
    .note strong {
      color: #111827;
    }
    svg {
      font-family: inherit;
    }
    .tooltip {
      position: absolute;
      background: rgba(17,24,39,0.95);
      color: #f9fafb;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 12px;
      pointer-events: none;
      line-height: 1.4;
    }
  </style>
</head>
<body>
  <h1>IDV Assignment 3 — D3 Replications (Charts 7–11)</h1>
  <p class="subtitle">
    Replications of the reference figures using SVG and D3.js, with basic transitions and interactions.
  </p>

  <!-- Chart 7 -->
  <div class="chart-card">
    <h2 class="chart-title">Chart 7 — Venn Diagram</h2>
    <p class="chart-subtitle">Three-set Venn diagram showing overlapping regions I–VII.</p>
    <div id="chart7"></div>
    <p class="note">
      <strong>Note:</strong> This chart replicates the three-set Venn diagram with labeled regions (I–VII).
      Position and size of the circles are encoded using the x/y coordinates and radius of each set.
      Color hue encodes the three categories (Replace, Delete, Rewrite), while opacity highlights the
      overlapping areas in the center. Text labels in each region support precise reading of the sets.
      A subtle fade-in transition is used when the circles are drawn to emphasize the layered structure.
    </p>
  </div>

  <!-- Chart 8 -->
  <div class="chart-card">
    <h2 class="chart-title">Chart 8 — Cross Validation Accuracy Bars</h2>
    <p class="chart-subtitle">Simple bar chart with dashed “baseline” bars in the background.</p>
    <div id="chart8"></div>
    <p class="note">
      <strong>Note:</strong> Here the horizontal position encodes the model category (BERT, RoBERTa, BART),
      and bar height encodes cross-validation accuracy in percentage. Solid yellow bars show the reported
      accuracy values, while dashed outline bars encode a lower comparison baseline for each model.
      Axes and a chart title support quantitative reading. A load-in animation grows the bars from zero,
      and hover highlights each bar to draw attention to individual values.
    </p>
  </div>

  <!-- Chart 9 -->
  <div class="chart-card">
    <h2 class="chart-title">Chart 9 — Sketch to SVG Figure</h2>
    <p class="chart-subtitle">Line-drawing style character sitting on a block, recreated as SVG paths.</p>
    <div id="chart9"></div>
    <p class="note">
      <strong>Note:</strong> This chart demonstrates how a hand-drawn sketch can be translated into vector
      shapes in SVG. The character is decomposed into simple geometric primitives: rectangles for the
      block and head, lines and paths for the limbs, and small markers for the hands and feet.
      Using SVG ensures the figure is resolution-independent and can be styled or animated with D3.
      On hover, the stroke color changes slightly, hinting that the illustration is built from vector
      elements rather than a bitmap image.
    </p>
  </div>

  <!-- Chart 10 -->
  <div class="chart-card">
    <h2 class="chart-title">Chart 10 — Map with Highlighted Region</h2>
    <p class="chart-subtitle">Abstract map with land shapes and a red ellipse indicating the focus area.</p>
    <div id="chart10"></div>
    <p class="note">
      <strong>Note:</strong> This figure approximates the reference map using a set of polygonal land masses
      drawn in a muted yellow, overlaid on a light grid to suggest geographic coordinates.
      A red elliptical outline encodes the area of interest, guiding the viewer’s attention to a
      particular sub-region. Even though the shapes are stylized, using precise SVG coordinates allows
      the map to be reproducible and scalable, and the grid hints at the underlying spatial reference
      system used for mapping.
    </p>
  </div>

  <!-- Chart 11 -->
  <div class="chart-card">
    <h2 class="chart-title">Chart 11 — Probability Density Functions</h2>
    <p class="chart-subtitle">Two Gaussian curves with a shaded overlapping region and reference lines.</p>
    <div id="chart11"></div>
    <p class="note">
      <strong>Note:</strong> This chart shows two probability density functions as smooth lines over the
      same x-axis. Each curve encodes a different class distribution via color (gold vs teal).
      The filled grey area represents the overlapping region where the densities are similar,
      highlighting potential classification ambiguity. Vertical dashed reference lines support
      reading of decision thresholds. The curves are sampled from analytic Gaussian functions and
      rendered with D3 line generators, demonstrating how mathematical functions can be visualized
      precisely in SVG.
    </p>
  </div>

  <script>
    // Shared tooltip (used only where needed)
    const tooltip = d3.select("body")
      .append("div")
      .attr("class", "tooltip")
      .style("opacity", 0);

    // =========================
    // Chart 7: Venn diagram
    // =========================
    function drawChart7() {
      const width = 420;
      const height = 260;

      const svg = d3.select("#chart7")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

      const g = svg.append("g")
        .attr("transform", "translate(0,10)");

      const circles = [
        { id: "A", cx: 150, cy: 120, r: 80, color: "#c4b5fd", label: "Delete" },
        { id: "B", cx: 220, cy: 80,  r: 80, color: "#bfdbfe", label: "Replace" },
        { id: "C", cx: 260, cy: 140, r: 80, color: "#fde68a", label: "Rewrite" }
      ];

      g.selectAll("circle.venn")
        .data(circles)
        .enter()
        .append("circle")
        .attr("class", "venn")
        .attr("cx", d => d.cx)
        .attr("cy", d => d.cy)
        .attr("r", 0)
        .attr("fill", d => d.color)
        .attr("fill-opacity", 0.55)
        .attr("stroke", "#4b5563")
        .attr("stroke-width", 1)
        .transition()
        .duration(800)
        .attr("r", d => d.r);

      // Region labels (positions are hand-tuned to match the reference)
      const labels = [
        { text: "I",  x: 90,  y: 140 },
        { text: "II", x: 220, y: 30 },
        { text: "III",x: 330, y: 145 },
        { text: "IV", x: 165, y: 115 },
        { text: "V",  x: 235, y: 110 },
        { text: "VI", x: 205, y: 150 },
        { text: "VII",x: 220, y: 130 }
      ];

      g.selectAll("text.region")
        .data(labels)
        .enter()
        .append("text")
        .attr("class", "region")
        .attr("x", d => d.x)
        .attr("y", d => d.y)
        .attr("text-anchor", "middle")
        .attr("dominant-baseline", "central")
        .style("font-size", "13px")
        .style("fill", "#111827")
        .text(d => d.text);

      // Set labels at top
      g.append("text")
        .attr("x", 70)
        .attr("y", 30)
        .style("font-size", "12px")
        .text("Delete");
      g.append("text")
        .attr("x", 210)
        .attr("y", 20)
        .style("font-size", "12px")
        .text("Replace");
      g.append("text")
        .attr("x", 330)
        .attr("y", 40)
        .style("font-size", "12px")
        .text("Rewrite");
    }

    // =========================
    // Chart 8: Simple bars
    // =========================
    function drawChart8() {
      const data = [
        { model: "BERT",    base: 74.4, dashed: 64.8 },
        { model: "RoBERTa", base: 81.9, dashed: 65.5 },
        { model: "BART",    base: 73.1, dashed: 63.5 }
      ];

      const margin = { top: 40, right: 20, bottom: 40, left: 40 };
      const width  = 420 - margin.left - margin.right;
      const height = 240 - margin.top - margin.bottom;

      const svg = d3.select("#chart8")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

      const x = d3.scaleBand()
        .domain(data.map(d => d.model))
        .range([0, width])
        .padding(0.4);

      const y = d3.scaleLinear()
        .domain([0, 100])
        .nice()
        .range([height, 0]);

      // axes
      svg.append("g")
        .attr("transform", `translate(0,${height})`)
        .call(d3.axisBottom(x));

      svg.append("g")
        .call(d3.axisLeft(y).ticks(5));

      // y = 0 baseline
      svg.append("line")
        .attr("x1", 0)
        .attr("x2", width)
        .attr("y1", height)
        .attr("y2", height)
        .attr("stroke", "#111827")
        .attr("stroke-width", 1);

      // solid bars (accuracy)
      svg.selectAll(".bar-base")
        .data(data)
        .enter()
        .append("rect")
        .attr("class", "bar-base")
        .attr("x", d => x(d.model))
        .attr("width", x.bandwidth())
        .attr("y", height)
        .attr("height", 0)
        .attr("fill", "#f9e4a4")
        .attr("stroke", "#b38f3b")
        .attr("stroke-width", 0.8)
        .on("mouseover", function(event, d) {
          d3.select(this).attr("fill", "#fde68a");
          tooltip
            .style("opacity", 1)
            .html(`<strong>${d.model}</strong><br/>Accuracy: ${d.base}%`)
            .style("left", (event.pageX + 10) + "px")
            .style("top", (event.pageY - 28) + "px");
        })
        .on("mouseout", function() {
          d3.select(this).attr("fill", "#f9e4a4");
          tooltip.style("opacity", 0);
        })
        .transition()
        .duration(800)
        .attr("y", d => y(d.base))
        .attr("height", d => height - y(d.base));

      // dashed bars (baseline)
      svg.selectAll(".bar-dashed")
        .data(data)
        .enter()
        .append("rect")
        .attr("class", "bar-dashed")
        .attr("x", d => x(d.model) + x.bandwidth() * 0.1)
        .attr("width", x.bandwidth() * 0.8)
        .attr("y", d => y(d.dashed))
        .attr("height", d => height - y(d.dashed))
        .attr("fill", "none")
        .attr("stroke", "#d4b866")
        .attr("stroke-dasharray", "4,3")
        .attr("stroke-width", 1.2);

      // labels above bars
      svg.selectAll(".label-base")
        .data(data)
        .enter()
        .append("text")
        .attr("class", "label-base")
        .attr("x", d => x(d.model) + x.bandwidth() / 2)
        .attr("y", d => y(d.base) - 6)
        .attr("text-anchor", "middle")
        .style("font-size", "11px")
        .text(d => d.base.toFixed(1));

      svg.selectAll(".label-dashed")
        .data(data)
        .enter()
        .append("text")
        .attr("class", "label-dashed")
        .attr("x", d => x(d.model) + x.bandwidth() / 2)
        .attr("y", d => y(d.dashed) + 12)
        .attr("text-anchor", "middle")
        .style("font-size", "10px")
        .style("fill", "#6b7280")
        .text(d => d.dashed.toFixed(1));

      // chart title
      svg.append("text")
        .attr("x", width / 2)
        .attr("y", -15)
        .attr("text-anchor", "middle")
        .style("font-size", "13px")
        .style("font-weight", "bold")
        .text("Cross Validation Accuracy (%)");
    }

    // =========================
    // Chart 9: Sketch to SVG
    // =========================
    function drawChart9() {
      const width = 360;
      const height = 220;

      const svg = d3.select("#chart9")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .style("background", "#f9fafb");

      const g = svg.append("g")
        .attr("transform", "translate(40,15)")
        .attr("stroke", "#4b5563")
        .attr("fill", "none")
        .attr("stroke-linecap", "round")
        .attr("stroke-linejoin", "round");

      // block
      g.append("rect")
        .attr("x", 30)
        .attr("y", 110)
        .attr("width", 220)
        .attr("height", 40)
        .attr("fill", "#e5e7eb")
        .attr("stroke-width", 1.2);

      // body
      g.append("line").attr("x1", 140).attr("y1", 80).attr("x2", 140).attr("y2", 120).attr("stroke-width", 1.5);

      // head (square)
      g.append("rect")
        .attr("x", 115)
        .attr("y", 30)
        .attr("width", 50)
        .attr("height", 40)
        .attr("fill", "#f3f4f6")
        .attr("stroke-width", 1.5);

      // face
      g.append("line").attr("x1", 125).attr("y1", 48).attr("x2", 135).attr("y2", 48);
      g.append("line").attr("x1", 146).attr("y1", 48).attr("x2", 156).attr("y2", 48);
      g.append("line").attr("x1", 130).attr("y1", 58).attr("x2", 150).attr("y2", 58);

      // left leg
      g.append("line").attr("x1", 140).attr("y1", 120).attr("x2", 120).attr("y2", 150);
      g.append("line").attr("x1", 120).attr("y1", 150).attr("x2", 115).attr("y2", 165);

      // right leg
      g.append("line").attr("x1", 140).attr("y1", 120).attr("x2", 155).attr("y2", 150);
      g.append("line").attr("x1", 155).attr("y1", 150).attr("x2", 160).attr("y2", 165);

      // arms and stick
      g.append("line").attr("x1", 140).attr("y1", 90).attr("x2", 110).attr("y2", 110);
      g.append("line").attr("x1", 140).attr("y1", 90).attr("x2", 170).attr("y2", 105);

      g.append("line").attr("x1", 105).attr("y1", 108).attr("x2", 185).attr("y2", 130);

      // small circles for hands
      g.append("circle").attr("cx", 110).attr("cy", 110).attr("r", 3).attr("fill", "#4b5563");
      g.append("circle").attr("cx", 170).attr("cy", 105).attr("r", 3).attr("fill", "#4b5563");

      // hover effect on whole group
      g.on("mouseover", function() {
          d3.select(this).attr("stroke", "#1f2937");
        })
        .on("mouseout", function() {
          d3.select(this).attr("stroke", "#4b5563");
        });
    }

    // =========================
    // Chart 10: Map
    // =========================
    function drawChart10() {
      const width = 360;
      const height = 260;

      const svg = d3.select("#chart10")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .style("background", "#f9fafb");

      const margin = { top: 20, right: 20, bottom: 20, left: 20 };
      const innerWidth = width - margin.left - margin.right;
      const innerHeight = height - margin.top - margin.bottom;

      const g = svg.append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

      // draw grid
      const step = 24;
      for (let x = 0; x <= innerWidth; x += step) {
        g.append("line")
          .attr("x1", x)
          .attr("y1", 0)
          .attr("x2", x)
          .attr("y2", innerHeight)
          .attr("stroke", "#e5e7eb")
          .attr("stroke-width", 0.6);
      }
      for (let y = 0; y <= innerHeight; y += step) {
        g.append("line")
          .attr("x1", 0)
          .attr("y1", y)
          .attr("x2", innerWidth)
          .attr("y2", y)
          .attr("stroke", "#e5e7eb")
          .attr("stroke-width", 0.6);
      }

      // land shapes (abstract polygons)
      const land = [
        [[40, 40],[110, 35],[140, 60],[120, 110],[60, 100]],
        [[170, 50],[240, 45],[260, 80],[230, 110],[185, 95]],
        [[70, 150],[120, 145],[150, 175],[130, 210],[80, 200]],
        [[190, 150],[250, 160],[260, 195],[220, 210],[190, 190]]
      ];

      g.selectAll("polygon.land")
        .data(land)
        .enter()
        .append("polygon")
        .attr("class", "land")
        .attr("points", d => d.map(p => p.join(",")).join(" "))
        .attr("fill", "#f4d7a4")
        .attr("stroke", "#d1a65a")
        .attr("stroke-width", 0.8)
        .attr("opacity", 0)
        .transition()
        .duration(800)
        .attr("opacity", 1);

      // highlight ellipse
      g.append("ellipse")
        .attr("cx", innerWidth * 0.55)
        .attr("cy", innerHeight * 0.45)
        .attr("rx", 90)
        .attr("ry", 70)
        .attr("fill", "none")
        .attr("stroke", "#dc2626")
        .attr("stroke-width", 2);

      // simple axis-like ticks (optional, just for vibe)
      svg.append("text")
        .attr("x", width / 2)
        .attr("y", 16)
        .attr("text-anchor", "middle")
        .style("font-size", "12px")
        .text("Abstract Map with Focus Region");
    }

    // =========================
    // Chart 11: Functions
    // =========================
    function drawChart11() {
      const margin = { top: 30, right: 20, bottom: 40, left: 45 };
      const width  = 420 - margin.left - margin.right;
      const height = 260 - margin.top - margin.bottom;

      const svg = d3.select("#chart11")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

      const x = d3.scaleLinear()
        .domain([-2, 5])
        .range([0, width]);

      const y = d3.scaleLinear()
        .domain([0, 0.35])
        .range([height, 0]);

      const xAxis = d3.axisBottom(x).ticks(7);
      const yAxis = d3.axisLeft(y).ticks(5);

      svg.append("g")
        .attr("transform", `translate(0,${height})`)
        .call(xAxis);

      svg.append("g")
        .call(yAxis);

      // axis labels
      svg.append("text")
        .attr("x", width / 2)
        .attr("y", height + 32)
        .attr("text-anchor", "middle")
        .style("font-size", "12px")
        .text("x");

      svg.append("text")
        .attr("transform", "rotate(-90)")
        .attr("x", -height / 2)
        .attr("y", -32)
        .attr("text-anchor", "middle")
        .style("font-size", "12px")
        .text("Probability Density");

      // Gaussian functions
      function gaussian(x, mu, sigma) {
        const coeff = 1 / (Math.sqrt(2 * Math.PI) * sigma);
        const expo  = -Math.pow(x - mu, 2) / (2 * sigma * sigma);
        return coeff * Math.exp(expo);
      }

      const xs = d3.range(-2, 5.01, 0.05);

      const data0 = xs.map(d => ({ x: d, y: gaussian(d, 0.2, 0.9) }));
      const data1 = xs.map(d => ({ x: d, y: gaussian(d, 1.8, 0.8) }));

      const line0 = d3.line()
        .x(d => x(d.x))
        .y(d => y(d.y));

      const line1 = d3.line()
        .x(d => x(d.x))
        .y(d => y(d.y));

      // area of overlap: min of two densities
      const overlap = xs.map(d => {
        const y0 = gaussian(d, 0.2, 0.9);
        const y1 = gaussian(d, 1.8, 0.8);
        return { x: d, y0, y1, y: Math.min(y0, y1) };
      });

      const areaOverlap = d3.area()
        .x(d => x(d.x))
        .y0(y(0))
        .y1(d => y(d.y));

      svg.append("path")
        .datum(overlap)
        .attr("fill", "#9ca3af")
        .attr("opacity", 0.5)
        .attr("d", areaOverlap);

      // curves
      svg.append("path")
        .datum(data0)
        .attr("fill", "none")
        .attr("stroke", "#f59e0b")
        .attr("stroke-width", 2)
        .attr("d", line0);

      svg.append("path")
        .datum(data1)
        .attr("fill", "none")
        .attr("stroke", "#0ea5e9")
        .attr("stroke-width", 2)
        .attr("d", line1);

      // vertical reference lines
      const vlines = [0, 1, 2];
      svg.selectAll(".vline")
        .data(vlines)
        .enter()
        .append("line")
        .attr("class", "vline")
        .attr("x1", d => x(d))
        .attr("x2", d => x(d))
        .attr("y1", height)
        .attr("y2", 0)
        .attr("stroke", "#6b7280")
        .attr("stroke-dasharray", "4,3")
        .attr("stroke-width", 1);

      // legend
      const legend = svg.append("g")
        .attr("transform", `translate(${width - 160}, 10)`);

      legend.append("line")
        .attr("x1", 0).attr("y1", 0)
        .attr("x2", 26).attr("y2", 0)
        .attr("stroke", "#f59e0b")
        .attr("stroke-width", 2);
      legend.append("text")
        .attr("x", 32).attr("y", 3)
        .style("font-size", "11px")
        .text("p(x, y = 0) * v(x)");

      legend.append("line")
        .attr("x1", 0).attr("y1", 16)
        .attr("x2", 26).attr("y2", 16)
        .attr("stroke", "#0ea5e9")
        .attr("stroke-width", 2);
      legend.append("text")
        .attr("x", 32).attr("y", 19)
        .style("font-size", "11px")
        .text("p(x, y = 1) * v(x)");
    }

    // Draw all charts
    drawChart7();
    drawChart8();
    drawChart9();
    drawChart10();
    drawChart11();
  </script>
</body>
</html>
